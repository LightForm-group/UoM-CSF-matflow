name: tension_DAMASK_Mg

# archive: dropbox
run_options:
  l: short

tasks:
  - name: generate_microstructure_seeds
    method: random
    software: damask
    base:
      size: [1, 1, 1]
      num_grains: 100
      phase_label: Mg

  - name: generate_volume_element
    method: random_voronoi
    software: damask
    base:
      grid_size: [16, 16, 16]
      homog_label: SX

  - name: visualise_volume_element
    method: VTK
    software: damask

  - name: generate_load_case
    method: uniaxial
    software: formable
    base:
      total_times: [50]
      num_increments: [2000]
      target_strain_rates: [1.0e-3]
      directions: [x]

  - name: simulate_volume_element_loading
    method: CP_FFT
    software: DAMASK
    run_options:
      num_cores: 4
    output_map_options:
      operations:
        - name: add_stress_Cauchy
          args: { P: P, F: F }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_strain
          args: { F: F_p, t: V, m: 0 }
          opts: { add_Mises: true }
        - name: add_IPF_color
          args: { l: [0, 0, 1] }
      phase_data:
        - field_name: sigma_vM
          phase_name: Mg
          out_name: vol_avg_equivalent_stress
          transforms: [mean_along_axes: 1]
        - field_name: epsilon_V^0(F)_vM
          phase_name: Mg
          out_name: vol_avg_equivalent_strain
          transforms: [mean_along_axes: 1]
        - field_name: epsilon_V^0(F_p)_vM
          phase_name: Mg
          out_name: vol_avg_equivalent_plastic_strain
          transforms: [mean_along_axes: 1]
          increments:
            - step: 10
      field_data:
        - field_name: phase
        # Extract the voxel orientations at initial and final increments
        - field_name: O
          increments:
            - values: [0, -1]
      grain_data:
        # Extract the grain-averaged orientations at initial and final increments
        - field_name: O
          increments:
            - values: [0, -1]
      visualise: # Generate VTR files for increments: [10, 12, 14, 16, 18, 20]
        fields: [F, F_p, P, sigma_vM, O, IPFcolor_(0 0 1), phase]
        increments:
          - start: 10
            stop: 20
            step: 2
    base:
      homogenization_schemes:
        SX:
          mechanical:
            type: pass
          N_constituents: 1
      numerics:
        grid:
          maxCutBack: 8
      phases:
        Mg:
          lattice: hP
          c/a: 1.62350 # from Tromans 2011, Elastic Anisotropy of HCP Metal Crystals and Polycrystals
          mechanical:
            output:
              - F # deformation gradient (total)
              - P # stress (piola-kirchoff)
              - F_p # deformation gradient (plastic part)
              - O # orientations (as quaternions)
            elastic:
              type: Hooke
              C_11: 59.3e9
              C_12: 25.7e9
              C_13: 21.4e9
              C_33: 61.5e9
              C_44: 16.4e9
            plastic:
              type: phenopowerlaw
              output:
                - gamma_sl # slip volume fraction
                - gamma_tw # twinning volume fraction
                - xi_sl # slip resistance
                - xi_tw # twinning resistance
              N_sl: [3, 3, 0, 6, 0, 6] # Number of slip systems to include - basal  prism  prism pyr(a) pyr(c+a) pyr(c+a)
              xi_0_sl: [10.0e6, 55.0e6, 0, 60.0e6, 0.0, 60.0e6] # basal  prism  prism pyr(a) pyr(c+a) pyr(c+a)
              xi_inf_sl: [40.0e6, 135.0e6, 0, 150.0e6, 0.0, 150.0e6] # basal  prism  prism pyr(a) pyr(c+a) pyr(c+a)
              N_tw: [6, 0, 0, 6] # Number of twin systems to include - tensile 1, compressive 1, tensile 2, compressive 2
              xi_0_tw: [40e6, 0.0, 0.0, 60.0e6] # tensile 1, compressive 1, tensile 2, compressive 2
              a_sl: 2.25
              dot_gamma_0_sl: 0.001
              dot_gamma_0_tw: 0.001
              h_0_sl_sl: 500.0e6
              n_sl: 20
              n_tw: 20
              c_1: 0.0
              c_2: 0.0
              c_3: 20.0
              c_4: 20.0
              f_sl_sat_tw: 10.0
              h_0_tw_tw: 50.0e6
              h_0_tw_sl: 150.0e6
              f_sat_sl_tw: 10.0
              h_sl_sl:
                [
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                ]
              h_tw_tw:
                [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
              h_sl_tw:
                [
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                ]
              h_tw_sl:
                [
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                  1,
                ]
