# --- hpcflow profile generated by matflow (version: 0.2.22) on 2021.09.23 at 08:47:55 ---
# Note: modifications to this profile do NOT modify the matflow workflow submission.

parallel_modes:
  mpi:
    command: mpirun -np <<num_cores>>
  openmp:
    env:
      - export OMP_NUM_THREADS=<<num_cores>>
scheduler: sge
output_dir: output
error_dir: output
command_groups:
  - directory: .
    nesting: hold
    commands:
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow prepare-task --task-idx=0 --iteration-idx=$ITER_IDX
    stats: false
    scheduler_options:
      P: jf01.prj
      l: short
    name: t1_pre
  - directory: <<task_1_generate_microstructure_seeds_dirs>>
    nesting: hold
    commands:
      - line: matflow run-python-task --task-idx=0 --element-idx=$((($ITER_IDX * $SGE_TASK_LAST) + $SGE_TASK_ID - 1)) --directory=/net/scratch2/mbdxqap3/test-matflow/retest/generate_RVE_2021-09-23-084754
    scheduler_options:
      P: jf01.prj
      l: short
    name: t1
    stats: false
    stats_name: s1
    environment: |-
      module purge
      module load tools/env/proxy
      module load mpi/intel-18.0/openmpi/4.1.0
      module load tools/gcc/cmake/3.13.2
      module load apps/binapps/anaconda3/2020.07
      export PETSC_DIR=/mnt/eps01-rds/jf01-home01/shared/petsc-3.15.2
      export PETSC_ARCH=mkl-opt
      export DAMASK_ROOT=/mnt/eps01-rds/jf01-home01/shared/DAMASK-v3a3
      export HDF5_USE_FILE_LOCKING=FALSE
      source $DAMASK_ROOT/env/DAMASK.sh
      export OMP_NUM_THREADS=1
      PATH=$PETSC_DIR/$PETSC_ARCH/bin:$PATH
      LD_LIBRARY_PATH=$PETSC_DIR/$PETSC_ARCH/lib:$LD_LIBRARY_PATH
      source activate /mnt/eps01-rds/jf01-home01/shared/.conda/damask_v3a3_final_env
  - directory: .
    nesting: hold
    commands:
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow process-task --task-idx=0 --iteration-idx=$ITER_IDX
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow prepare-task --task-idx=1 --iteration-idx=$ITER_IDX
    stats: false
    scheduler_options:
      P: jf01.prj
      l: short
    name: t1+2_aux
  - directory: <<task_2_generate_volume_element_dirs>>
    nesting: hold
    commands:
      - line: matflow run-python-task --task-idx=1 --element-idx=$((($ITER_IDX * $SGE_TASK_LAST) + $SGE_TASK_ID - 1)) --directory=/net/scratch2/mbdxqap3/test-matflow/retest/generate_RVE_2021-09-23-084754
    scheduler_options:
      P: jf01.prj
      l: short
    name: t2
    stats: false
    stats_name: s2
    environment: |-
      module purge
      module load tools/env/proxy
      module load mpi/intel-18.0/openmpi/4.1.0
      module load tools/gcc/cmake/3.13.2
      module load apps/binapps/anaconda3/2020.07
      export PETSC_DIR=/mnt/eps01-rds/jf01-home01/shared/petsc-3.15.2
      export PETSC_ARCH=mkl-opt
      export DAMASK_ROOT=/mnt/eps01-rds/jf01-home01/shared/DAMASK-v3a3
      export HDF5_USE_FILE_LOCKING=FALSE
      source $DAMASK_ROOT/env/DAMASK.sh
      export OMP_NUM_THREADS=1
      PATH=$PETSC_DIR/$PETSC_ARCH/bin:$PATH
      LD_LIBRARY_PATH=$PETSC_DIR/$PETSC_ARCH/lib:$LD_LIBRARY_PATH
      source activate /mnt/eps01-rds/jf01-home01/shared/.conda/damask_v3a3_final_env
  - directory: .
    nesting: hold
    commands:
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow process-task --task-idx=1 --iteration-idx=$ITER_IDX
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow prepare-task --task-idx=2 --iteration-idx=$ITER_IDX
    stats: false
    scheduler_options:
      P: jf01.prj
      l: short
    name: t2+3_aux
  - directory: <<task_3_visualise_volume_element_dirs>>
    nesting: hold
    commands:
      - line: matflow run-python-task --task-idx=2 --element-idx=$((($ITER_IDX * $SGE_TASK_LAST) + $SGE_TASK_ID - 1)) --directory=/net/scratch2/mbdxqap3/test-matflow/retest/generate_RVE_2021-09-23-084754
    scheduler_options:
      P: jf01.prj
      l: short
    name: t3
    stats: false
    stats_name: s3
    environment: |-
      module purge
      module load tools/env/proxy
      module load mpi/intel-18.0/openmpi/4.1.0
      module load tools/gcc/cmake/3.13.2
      module load apps/binapps/anaconda3/2020.07
      export PETSC_DIR=/mnt/eps01-rds/jf01-home01/shared/petsc-3.15.2
      export PETSC_ARCH=mkl-opt
      export DAMASK_ROOT=/mnt/eps01-rds/jf01-home01/shared/DAMASK-v3a3
      export HDF5_USE_FILE_LOCKING=FALSE
      source $DAMASK_ROOT/env/DAMASK.sh
      export OMP_NUM_THREADS=1
      PATH=$PETSC_DIR/$PETSC_ARCH/bin:$PATH
      LD_LIBRARY_PATH=$PETSC_DIR/$PETSC_ARCH/lib:$LD_LIBRARY_PATH
      source activate /mnt/eps01-rds/jf01-home01/shared/.conda/damask_v3a3_final_env
  - directory: .
    nesting: hold
    commands:
      - subshell: |-
          export HDF5_USE_FILE_LOCKING=FALSE
          export OMP_NUM_THREADS=1
          matflow process-task --task-idx=2 --iteration-idx=$ITER_IDX
    stats: false
    scheduler_options:
      P: jf01.prj
      l: short
    name: t3_pro
variables:
  task_1_generate_microstructure_seeds_dirs:
    file_regex:
      pattern: (task_1_generate_microstructure_seeds)$
      is_dir: true
      group: 0
    value: '{}'
  task_2_generate_volume_element_dirs:
    file_regex:
      pattern: (task_2_generate_volume_element)$
      is_dir: true
      group: 0
    value: '{}'
  task_3_visualise_volume_element_dirs:
    file_regex:
      pattern: (task_3_visualise_volume_element)$
      is_dir: true
      group: 0
    value: '{}'
